[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Fecal Indicator Bacteria and Hydrology",
    "section": "",
    "text": "Overview\nThis page is an exploration of how fecal indicator bacteria in the Tampa Bay watershed are influenced by hydrologic inputs. The primary audience is technical staff at TBEP so this information can be used in the development of bay-wide report cards. Because this is a very exploratory project meant primarily for internal use, but made public because open science and general transparency are important, the writing is more like a series of blog posts than a fully polished report.\nUnless otherwise noted, all data used are from estuarine stations.\nAs of 4/10/2024, daily precipitation data goes back to 2009 (previously was 2018)."
  },
  {
    "objectID": "data_sources.html#fecal-indicator-bacteria",
    "href": "data_sources.html#fecal-indicator-bacteria",
    "title": "1  Data Sources",
    "section": "1.1 Fecal Indicator Bacteria",
    "text": "1.1 Fecal Indicator Bacteria\nAll fecal indicator bacteria (FIB) data were downloaded from the Water Quality Portal, using tbeptools::read_importwqp(), from the following providers: Florida Department of Health (21FLDOH_WQX), Hillsborough County (21FLHILL_WQX), Manatee County (21FLMANA_WQX), Pasco County (21FLPASC_WQX), the Florida Department of Environmental Protection (21FLPDEM_WQX), and Polk County (21FLPOLK_WQX). The file generated during the Data Assessment portion of this project was re-used here. The script used for downloading and processing the data is on github."
  },
  {
    "objectID": "data_sources.html#hydrologic-loads",
    "href": "data_sources.html#hydrologic-loads",
    "title": "1  Data Sources",
    "section": "1.2 Hydrologic Loads",
    "text": "1.2 Hydrologic Loads\nMonthly hydrologic load estimates, generated by Janicki Environmental, Inc., were downloaded from TBEP’s Nitrogen Loads dashboard [‘Total Hydrologic Load (monthly, 1985 - 2021)’ button]."
  },
  {
    "objectID": "data_sources.html#radar-estimated-precipitation",
    "href": "data_sources.html#radar-estimated-precipitation",
    "title": "1  Data Sources",
    "section": "1.3 Radar-estimated precipitation",
    "text": "1.3 Radar-estimated precipitation\nMonthly and daily radar-estimated precipitation files, as well as a spatial layer containing the pixels for which estimates were made, were downloaded from the Southwest Florida Water Management District (SWFWMD) ftp site; that link was provided by the Tampa Bay Water Atlas.\nThese files are very large and are not committed in this github repository. Precipitation estimates of each type were processed using this script, and resulting in a monthly compiled rainfall file and a daily compiled rainfall file."
  },
  {
    "objectID": "data_sources.html#wbids",
    "href": "data_sources.html#wbids",
    "title": "1  Data Sources",
    "section": "1.4 WBIDs",
    "text": "1.4 WBIDs\nThe shapefile of all of FL’s Water Body IDs (WBIDs) from IWR Run 65 was downloaded from the FDEP Geospatial website."
  },
  {
    "objectID": "precip_and_hydro-loads.html#data-import",
    "href": "precip_and_hydro-loads.html#data-import",
    "title": "2  General Exploration of Precipitation and Hydrologic Loads",
    "section": "2.1 Data Import",
    "text": "2.1 Data Import\n\n\nCode\n# read in the .RData file made in making_dataframes.R\n# swfwmdpixels\n# bay_segs\n# prcp\n# daily_prcp\n# hydro\n\nload(here::here(\"sourced_data\", \"combined_precip.RData\"))\nload(here::here(\"sourced_data\", \"combined_spatial.RData\"))\n\n\n\n\nCode\n# subset precip for exploratory mapping; 2022 only\nprcp_bayseg &lt;- prcp |&gt; \n    summarize(.by = c(BAY_SEG, month, year),\n              inches = mean(inches, na.rm = TRUE)) |&gt; \n    filter(year == 2022) |&gt; \n    left_join(bay_segs) |&gt; \n    st_as_sf()\n\nprcp_pixel &lt;- prcp |&gt; \n    select(-BAY_SEG) |&gt; \n    distinct() |&gt; \n    filter(year == 2022) |&gt; \n    left_join(select(precip_pixels, PIXEL, geometry)) |&gt; \n    st_as_sf()"
  },
  {
    "objectID": "precip_and_hydro-loads.html#precip-maps-comparing-pixel-level-to-bay-segment-level",
    "href": "precip_and_hydro-loads.html#precip-maps-comparing-pixel-level-to-bay-segment-level",
    "title": "2  General Exploration of Precipitation and Hydrologic Loads",
    "section": "2.2 Precip maps, comparing pixel-level to bay-segment-level",
    "text": "2.2 Precip maps, comparing pixel-level to bay-segment-level\nI was unsure what level of “averaging up” would be appropriate for comparing precipitation with FIBs, so this section explores the differences. I subsetted data to only 2022.\n\n\nCode\nprcp_bayseg |&gt; \n    filter(month == 1) |&gt; \n    mapview(zcol = \"inches\",\n            layer.name = \"Jan 2022\")\n\n\n\n\n\n\n\nCode\nprcp_pixel |&gt; \n    filter(month == 1) |&gt; \n    mapview(zcol = \"inches\",\n            layer.name = \"Jan 2022\")\n\n\n\n\n\n\n\n\n\nCode\ntm_shape(prcp_bayseg) +\n    tm_borders() +\n    tm_fill(\"inches\",\n            n = 6,\n            palette = \"YlGnBu\") +\n    tm_facets(by = \"month\", nrow = 4)\n\n\n\n\n\nCode\ntm_shape(prcp_pixel) +\n    tm_fill(\"inches\",\n            n = 6,\n            palette = \"YlGnBu\") +\n    tm_facets(by = \"month\", nrow = 4)\n\n\n\n\n\nBased on the large temporal variation across the year, much larger than the difference between pixels, I decided that bay-segment averages would be fine (spoiler alert - they’re really not).\n\n\nCode\nprcp_bayseg &lt;- prcp |&gt; \n    summarize(.by = c(BAY_SEG, month, year),\n              inches = mean(inches, na.rm = TRUE)) |&gt; \n    filter(year == 2022) |&gt; \n    left_join(bay_segs) |&gt; \n    st_as_sf()\n\ntm_shape(prcp_bayseg) +\n    tm_borders() +\n    tm_fill(\"inches\",\n            palette = \"YlGnBu\",\n            n = 10) +\n    tm_facets(by = c(\"month\", \"year\"))"
  },
  {
    "objectID": "precip_and_hydro-loads.html#precip-and-hydrologic-loads",
    "href": "precip_and_hydro-loads.html#precip-and-hydrologic-loads",
    "title": "2  General Exploration of Precipitation and Hydrologic Loads",
    "section": "2.3 Precip and hydrologic loads",
    "text": "2.3 Precip and hydrologic loads\nEstimated precipitation and hydrologic loads seem like they should correlate pretty well, though that may vary by month, bay-segment, and/or wet vs. dry season. The relationships could be log-log relationships, otherwise non-linear relationships, or something surprising. This section explores these topics.\n\n\nCode\np &lt;- ggplot(combnd) +\n    geom_point(aes(x = inches, y = hydro_load,\n                   col = bay_segment))\n\np\n\n\n\n\n\nGenerally positive relationship (as you’d expect) but lots of spread, especially at higher precipitation levels.\nLooks like a lot of that variability is due to the different bay segments.\n\n\nCode\np +\n    facet_wrap(~bay_segment)\n\n\n\n\n\nHillsborough Bay has a lot of variability - not surprising since it’s the biggest of the watersheds. Looks like the relationships hold until about 12 inches, then higher points are both infrequent and possibly show some leveling off. This includes ~15 years of data (2009 and later) and looks almost exactly the same as when I used only 2016 and above.\nQuick look at hydrologic load and the previous month’s precip:\n\n\nCode\nggplot(combnd) +\n    geom_point(aes(x = lag1_prcp, y = hydro_load,\n                   col = bay_segment)) +\n    facet_wrap(~bay_segment) +\n    theme(legend.position = \"none\") +\n    labs(x = \"previous month's precipitation (inches)\",\n         y = \"hydrologic load\")\n\n\n\n\n\nLooks pretty similar, though with more variation; not entirely unexpected at this aggregation level.\n\n\nCode\nggplot(combnd) +\n    geom_point(aes(x = inches, y = hydro_load,\n                   col = factor(month))) +\n    scale_color_brewer(palette = \"Paired\") +\n    facet_wrap(~bay_segment)\n\n\n\n\n\nMakes sense that the relationship would vary by bay segment/watershed size. In Hillsborough Bay, we sort of see Aug-October on the high side of the hydrologic loads, even for the same amount of precipitation as in (e.g.) April.\n\n\nCode\nggplot(combnd) +\n    geom_point(aes(x = inches, y = hydro_load,\n                   col = bay_segment)) +\n    scale_color_brewer(palette = \"Set1\") +\n    facet_wrap(~month)\n\n\n\n\n\nVaries a lot by month and bay segment, especially in September.\n\n\nCode\nggplot(combnd) +\n    geom_boxplot(aes(x = factor(month), y = inches,\n                    col = bay_segment)) +\n    scale_color_brewer(palette = \"Set1\") +\n    labs(title = \"Precip variability by month x bay segment\",\n         x = \"Month\",\n         y = \"Monthly Total Precipitation (inches)\")\n\n\n\n\n\nCode\nggplot(combnd) +\n    geom_boxplot(aes(x = factor(month), y = hydro_load,\n                    col = bay_segment)) +\n    scale_color_brewer(palette = \"Set1\") +\n    labs(title = \"Hydro load variability by month x bay segment\",\n         x = \"Month\",\n         y = \"Monthly hydrologic load (10^6 m3)\")\n\n\n\n\n\nPrecip is similar between watersheds; hydrologic load is highest in Hillsborough Bay and lowest in lower Tampa Bay. Middle and Old Tampa Bay are pretty comparable."
  },
  {
    "objectID": "FIBs_and_hydrology.html#data-import",
    "href": "FIBs_and_hydrology.html#data-import",
    "title": "3  Fecal Indicator Bacteria (FIBs) and Hydrology",
    "section": "3.1 Data Import",
    "text": "3.1 Data Import\n\n\nCode\n# spatial and precip files\nload(here::here(\"sourced_data\", \"combined_precip.RData\"))\nload(here::here(\"sourced_data\", \"combined_spatial.RData\"))\n\n\n\n3.1.1 FIB data import\n\n\nCode\nfib_dat &lt;- readRDS(here::here(\"fib-data\", \"tbeptools_importwqp.rds\"))\n\nfib_sub &lt;- fib_dat |&gt; \n    filter(yr &gt;= 2009,\n           class == \"Estuary\",\n           var == \"ecocci\")\n\n# get those attached to bay segments  \nfib_baysegs &lt;- fib_sub |&gt; \n    st_as_sf(coords = c(\"Longitude\", \"Latitude\"),\n             crs = \"WGS84\",\n             remove = FALSE) |&gt;    # WGS84 is default for handheld GPS units\n    st_transform(crs = st_crs(swfwmdpixels)) |&gt; \n    st_intersection(bay_segs) |&gt; \n    mutate(bay_segment = case_match(BAY_SEG,\n                                    \"Boca Ciega Bay\" ~ \"Remainder Lower Tampa Bay\",\n                                    \"Manatee River\" ~ \"Remainder Lower Tampa Bay\",\n                                    .default = BAY_SEG))\n\nfib_hydro &lt;- left_join(fib_baysegs, combnd,\n                       by = c(\"yr\" = \"year\",\n                              \"mo\" = \"month\",\n                              \"bay_segment\"))\n\n\n\n\n3.1.2 Attach daily precipitation\n\n\nCode\nfib_daily_prcp &lt;- fib_baysegs |&gt; \n    mutate(date = as.Date(SampleTime),\n           Season = case_when(mo %in% c(6:9) ~ \"Wet\",\n                              .default = \"Dry\")) |&gt; \n    left_join(prcp_daily_bayseg,\n              by = c(\"date\", \"BAY_SEG\")) |&gt; \n    filter(!is.na(inches))"
  },
  {
    "objectID": "FIBs_and_hydrology.html#entero-by-monthly-hydro-load",
    "href": "FIBs_and_hydrology.html#entero-by-monthly-hydro-load",
    "title": "3  Fecal Indicator Bacteria (FIBs) and Hydrology",
    "section": "3.2 Entero by monthly hydro load",
    "text": "3.2 Entero by monthly hydro load\n\n\nCode\nggplot(fib_hydro, aes(x = hydro_load,\n                      y = val)) +\n    geom_jitter(aes(col = factor(mo)),\n               size = 2,\n               alpha = 0.5) +\n    geom_smooth() +\n    geom_rug(col = \"gray40\") +\n    scale_y_log10() +\n    scale_x_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Entero vs. hydrologic load; log-log scale\",\n         x = \"Hydrologic Load\",\n         y = \"Enterococcus\",\n         col = \"Month\")\n\n\n\n\n\nInteresting….. it’s not necessarily the monthly hydrologic loads that matter (though it’s clear that the higher hydrologic loads occur in certain months). Could come down to precipitation in some previous time periods.\nCould also be that because the majority of stations are in the bay proper, they’re diluted and that’s driving the lack-of-relationship. Really need to break this all out by “in-bay” vs. “have some land near the station” (what I later call “non-bay”).\n\n3.2.1 Lagged hydro load\n\n\nCode\nggplot(fib_hydro, aes(x = lag1_hydro,\n                      y = val)) +\n    geom_jitter(aes(col = factor(mo)),\n               size = 2,\n               alpha = 0.5) +\n    geom_smooth() +\n    geom_rug(col = \"gray40\") +\n    scale_y_log10() +\n    scale_x_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Entero vs. lagged hydrologic load; log-log scale\",\n         x = \"Hydrologic Load in previous month\",\n         y = \"Enterococcus\",\n         col = \"Month\")\n\n\n\n\n\nNothing new.\nFirst a little more exploration of entero concentrations by time of year."
  },
  {
    "objectID": "FIBs_and_hydrology.html#entero-by-monthly-precip",
    "href": "FIBs_and_hydrology.html#entero-by-monthly-precip",
    "title": "3  Fecal Indicator Bacteria (FIBs) and Hydrology",
    "section": "3.3 Entero by monthly precip",
    "text": "3.3 Entero by monthly precip\n\n\nCode\nggplot(fib_hydro, aes(x = inches,\n                      y = val)) +\n    geom_jitter(aes(col = factor(mo)),\n               size = 2,\n               alpha = 0.3) +\n    geom_smooth() +\n    geom_rug(col = \"gray40\") +\n    scale_y_log10() +\n    scale_x_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Entero vs. Monthly Precip\",\n         x = \"Precipitation (in)\",\n         y = \"Enterococcus\",\n         col = \"Month\")\n\n\n\n\n\nWe see a bit more of a relationship with precip than hydrologic load, at least in the higher values, but nothing clear or strong. What stands out most is that higher precipitation amounts tend to occur in certain months.\n\n3.3.1 Previous month’s precip\n\n\nCode\nggplot(fib_hydro, aes(x = lag1_prcp,\n                      y = val)) +\n    geom_jitter(aes(col = factor(mo)),\n               size = 2,\n               alpha = 0.3) +\n    geom_smooth() +\n    geom_rug(col = \"gray40\") +\n    scale_y_log10() +\n    scale_x_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Entero vs. Lagged Precip\",\n         x = \"Precipitation (in) in previous month\",\n         y = \"Enterococcus\",\n         col = \"Month\")\n\n\n\n\n\nNot very different."
  },
  {
    "objectID": "FIBs_and_hydrology.html#entero-by-month",
    "href": "FIBs_and_hydrology.html#entero-by-month",
    "title": "3  Fecal Indicator Bacteria (FIBs) and Hydrology",
    "section": "3.4 Entero by month",
    "text": "3.4 Entero by month\n\n\nCode\nggplot(fib_hydro,\n       aes(x = factor(mo),\n           y = val)) +\n    geom_jitter(aes(col = factor(mo)),\n                size = 0.7,\n                alpha = 0.4) +\n    geom_boxplot(alpha = 0) +\n    scale_y_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Entero counts by month\",\n         x = \"Month\",\n         y = \"Enterococcus\") +\n    theme(legend.position = \"none\")\n\n\n\n\n\nNo clear seasonal patterns in Enterococcus; as a reminder, all stations are included here, and patterns may emerge when we look only at the more land-influenced stations."
  },
  {
    "objectID": "FIBs_and_hydrology.html#hydro-load-by-month",
    "href": "FIBs_and_hydrology.html#hydro-load-by-month",
    "title": "3  Fecal Indicator Bacteria (FIBs) and Hydrology",
    "section": "3.5 Hydro load by month",
    "text": "3.5 Hydro load by month\nOnly since 2009, to keep data frame size under control.\n\n\nCode\nhydro_sub &lt;- hydro |&gt; \n    dplyr::filter(year &gt;= 2009)\n\n\n\n\nCode\nggplot(hydro_sub,\n       aes(x = factor(month),\n           y = hydro_load)) +\n    geom_jitter(aes(col = factor(month)),\n                size = 0.7,\n                alpha = 0.6) +\n    geom_boxplot(alpha = 0) +\n    scale_y_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Hydrologic Load by month\",\n         x = \"Month\",\n         y = \"Hydrologic Load\") +\n    theme(legend.position = \"none\")\n\n\n\n\n\nClear seasonality."
  },
  {
    "objectID": "FIBs_and_hydrology.html#precip-by-month",
    "href": "FIBs_and_hydrology.html#precip-by-month",
    "title": "3  Fecal Indicator Bacteria (FIBs) and Hydrology",
    "section": "3.6 Precip by month",
    "text": "3.6 Precip by month\n\n\nCode\nggplot(combnd,\n       aes(x = factor(month),\n           y = inches)) +\n    geom_jitter(aes(col = factor(month)),\n                size = 0.7,\n                alpha = 0.6) +\n    geom_boxplot(alpha = 0) +\n    scale_y_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Precip by month\",\n         x = \"Month\",\n         y = \"Monthly Precipitation (inches)\") +\n    theme(legend.position = \"none\")\n\n\n\n\n\nAgain, clear seasonality."
  },
  {
    "objectID": "FIBs_and_hydrology.html#inside-bay-vs.-not",
    "href": "FIBs_and_hydrology.html#inside-bay-vs.-not",
    "title": "3  Fecal Indicator Bacteria (FIBs) and Hydrology",
    "section": "3.7 Inside bay vs. not",
    "text": "3.7 Inside bay vs. not\nThe following stations are those that do not overlap with the tbeptools::tbseg layer - and so are not in the bay proper. For lack of a better term, I refer to these as “non-bay” stations. The graphics that follow are generally the same as those above, but on this subset of stations.\n\n\nCode\ntbseg2 &lt;- tbseg |&gt; \n    st_transform(crs = st_crs(swfwmdpixels))\n\nfib_nonbay &lt;- st_filter(fib_hydro, st_union(tbseg2), .predicate = st_disjoint)\n\n\nNote, this isn’t great spatial coverage. But it does seem more likely that we’d pick up a signal at these stations than if we included all of the ones that are in the bay too.\n\n\nCode\nmapview(fib_nonbay)\n\n\n\n\n\n\n\n\n3.7.1 Entero by month\n\n\nCode\nggplot(fib_nonbay,\n       aes(x = factor(mo),\n           y = val)) +\n    geom_jitter(aes(col = factor(mo)),\n                size = 0.7,\n                alpha = 0.4) +\n    geom_boxplot(alpha = 0) +\n    scale_y_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Entero counts by month\",\n         subtitle = \"stations that are not in the bay proper\",\n         x = \"Month\",\n         y = \"Enterococcus\") +\n    theme(legend.position = \"none\")\n\n\n\n\n\nStill really not any cycling…. surprising. There might be a little bit of a signal in Hillsborough Bay.\n\n\n3.7.2 Entero by monthly hydro load\n\n\nCode\nggplot(fib_nonbay, aes(x = hydro_load,\n                      y = val)) +\n    geom_jitter(aes(col = factor(mo)),\n               size = 2,\n               alpha = 0.5) +\n    geom_smooth() +\n    geom_rug(col = \"gray40\") +\n    scale_y_log10() +\n    # scale_x_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Entero vs. hydrologic load\",\n         subtitle = \"stations that are not in the bay proper\",\n         x = \"Hydrologic Load\",\n         y = \"Enterococcus\",\n         col = \"Month\")\n\n\n\n\n\n\n\nCode\nggplot(fib_nonbay, aes(x = hydro_load,\n                      y = val)) +\n    geom_jitter(aes(col = bay_segment),\n               size = 2,\n               alpha = 0.5) +\n    geom_smooth() +\n    geom_rug(col = \"gray40\") +\n    scale_y_log10() +\n    scale_x_log10() +\n    # facet_wrap(~bay_segment) +\n    labs(title = \"Entero vs. hydrologic load; log-log scale\",\n         subtitle = \"stations that are not in the bay proper\",\n         x = \"Hydrologic Load\",\n         y = \"Enterococcus\",\n         col = \"Bay Segment\")\n\n\n\n\n\n\n\n3.7.3 Entero and precip\n\n\nCode\nggplot(fib_nonbay, aes(x = inches,\n                      y = val)) +\n    geom_jitter(aes(col = bay_segment),\n               size = 2,\n               alpha = 0.5) +\n    geom_smooth() +\n    geom_rug(col = \"gray40\") +\n    scale_y_log10() +\n    # scale_x_log10() +\n    # facet_wrap(~bay_segment) +\n    labs(title = \"Entero vs. precip\",\n         subtitle = \"stations that are not in the bay proper\",\n         x = \"Precipitation (in)\",\n         y = \"Enterococcus\",\n         col = \"Bay Segment\")\n\n\n\n\n\n\n\nCode\nggplot(fib_nonbay, aes(x = inches,\n                      y = val)) +\n    geom_jitter(aes(col = bay_segment),\n               size = 2,\n               alpha = 0.5) +\n    geom_smooth() +\n    geom_rug(col = \"gray40\") +\n    scale_y_log10() +\n    # scale_x_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Entero vs. precip\",\n         subtitle = \"stations that are not in the bay proper\",\n         x = \"Precipitation (in)\",\n         y = \"Enterococcus\",\n         col = \"Bay Segment\") +\n    theme(legend.position = \"none\")\n\n\n\n\n\nCode\nggplot(fib_nonbay, aes(x = inches,\n                      y = val)) +\n    geom_jitter(aes(col = bay_segment),\n               size = 2,\n               alpha = 0.5) +\n    geom_smooth() +\n    geom_rug(col = \"gray40\") +\n    scale_y_log10() +\n    scale_x_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Entero vs. precip; log-log scale\",\n         subtitle = \"stations that are not in the bay proper\",\n         x = \"Precipitation (in)\",\n         y = \"Enterococcus\",\n         col = \"Bay Segment\") +\n    theme(legend.position = \"none\")\n\n\n\n\n\nChanging the x-axis between log and ‘regular’ really changes how it looks.\n\n\n3.7.4 Lagged precip\n\n\nCode\nggplot(fib_nonbay, aes(x = lag1_prcp,\n                      y = val)) +\n    geom_jitter(aes(col = bay_segment),\n               size = 2,\n               alpha = 0.5) +\n    geom_smooth() +\n    geom_rug(col = \"gray40\") +\n    scale_y_log10() +\n    # scale_x_log10() +\n    # facet_wrap(~bay_segment) +\n    labs(title = \"Entero vs. lagged precip\",\n         subtitle = \"stations that are not in the bay proper\",\n         x = \"Previous Month's Precipitation (in)\",\n         y = \"Enterococcus\",\n         col = \"Bay Segment\")\n\n\n\n\n\n\n\nCode\nggplot(fib_nonbay, aes(x = lag1_prcp,\n                      y = val)) +\n    geom_jitter(aes(col = as.factor(mo)),\n               size = 2,\n               alpha = 0.5) +\n    geom_smooth() +\n    geom_rug(col = \"gray40\") +\n    scale_y_log10() +\n    # scale_x_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Entero vs. lagged precip\",\n         subtitle = \"stations that are not in the bay proper\",\n         x = \"Previous Month's Precipitation (in)\",\n         y = \"Enterococcus\",\n         col = \"Month\")\n\n\n\n\n\nCode\nggplot(fib_nonbay, aes(x = lag1_prcp,\n                      y = val)) +\n    geom_jitter(aes(col = factor(mo)),\n               size = 2,\n               alpha = 0.5) +\n    geom_smooth() +\n    geom_rug(col = \"gray40\") +\n    scale_y_log10() +\n    scale_x_log10() +\n    facet_wrap(~bay_segment) +\n    labs(title = \"Entero vs. lagged precip; log-log scale\",\n         subtitle = \"stations that are not in the bay proper\",\n         x = \"Precipitation (in)\",\n         y = \"Enterococcus\",\n         col = \"Month\")"
  },
  {
    "objectID": "FIBs_and_hydrology.html#a-few-individual-sites",
    "href": "FIBs_and_hydrology.html#a-few-individual-sites",
    "title": "3  Fecal Indicator Bacteria (FIBs) and Hydrology",
    "section": "3.8 A few individual sites",
    "text": "3.8 A few individual sites\nOrgID 21FLHILL_WQX Stations 22, 136, 036, 054\n\n\nCode\nfib_tiny &lt;- fib_hydro |&gt; \n    dplyr::filter(OrgID == \"21FLHILL_WQX\",\n           Station %in% c(\"22\", \"136\", \"036\", \"054\"))\nmapview(fib_tiny)\n\n\n\n\n\n\n\n\n3.8.1 Time Series\n\n\nCode\nfib_long &lt;- fib_tiny |&gt; \n    mutate(Date = lubridate::ymd(paste(yr, mo, \"01\"))) |&gt; \n    rename(Entero = val) |&gt; \n    select(OrgID, Station, Date, Entero, bay_segment, inches, hydro_load, lag1_prcp, lag1_hydro, geometry) |&gt; \n    pivot_longer(c(Entero, inches, hydro_load, lag1_prcp, lag1_hydro),\n                 names_to = \"variable\",\n                 values_to = \"value\")\n\n\n\n\nCode\nggplot(fib_long, aes(x = Date, y = value, col = Station)) +\n    geom_point() +\n    geom_line() +\n    scale_y_log10() +\n    facet_wrap(~variable, scales = \"free_y\",\n               ncol = 1)\n\n\n\n\n\nHm, at least one station stopped being sampled, and it’s one where enterococcus was generally high. When doing report cards, will need to make sure we track individual stations or account for variability in sampling in a different way.\n\n\nCode\nggplot(fib_tiny, aes(x = inches, y = val, col = Station, group = Station)) +\n    geom_point(size = 2, alpha = 0.7) +\n    scale_y_log10() +\n    geom_smooth(method = \"lm\", se = FALSE) +\n    labs(x = \"Precip\",\n         y = \"Entero\")\n\n\n\n\n\nAnd really it looks like values within a station are sort of within their own range, different than other stations, as opposed to really correlating with precip (at least these few stations, on this graph). Maybe a bit of a relationship if we force it to linear rather than loess.\n\n\nCode\nggplot(fib_tiny, aes(x = lag1_prcp, y = val, col = Station, group = Station)) +\n    geom_point(size = 2, alpha = 0.7) +\n    scale_y_log10() +\n    geom_smooth(method = \"lm\", se = FALSE) +\n    labs(x = \"Lagged Precip\",\n         y = \"Entero\")\n\n\n\n\n\nA little different, but not much.\n\n\nCode\nggplot(fib_tiny, aes(x = hydro_load, y = val, col = Station, group = Station)) +\n    geom_point(size = 2, alpha = 0.7) +\n    scale_y_log10() +\n    geom_smooth(method = \"lm\", se = FALSE) +\n    labs(x = \"Hydro load\",\n         y = \"Entero\")"
  },
  {
    "objectID": "FIBs_and_hydrology.html#daily-level-precipitation",
    "href": "FIBs_and_hydrology.html#daily-level-precipitation",
    "title": "3  Fecal Indicator Bacteria (FIBs) and Hydrology",
    "section": "3.9 Daily-level precipitation",
    "text": "3.9 Daily-level precipitation\nThere weren’t many relationships with monthly precipitation, but could be more with a finer scale time period. This section incorporates the time periods: day-of-sampling, day + day before (24 hrs), day + 2 days before (48 hrs), and day + week before (7-day)\n\n\nCode\nfib_daily_nonbay &lt;- st_filter(fib_daily_prcp, st_union(tbseg2), .predicate = st_disjoint)\n\nfib_daily_long &lt;- fib_daily_prcp |&gt; \n    pivot_longer(inches:daily_7d,\n                 names_to = \"time_period\",\n                 values_to = \"total\") |&gt; \n    mutate(time_period = case_match(time_period,\n                                    \"inches\" ~ \"day of sample\",\n                                    \"daily_24hrs\" ~ \"sample + previous day\",\n                                    \"daily_48hrs\" ~ \"sample + 2 days\",\n                                    \"daily_7d\" ~ \"previous week\"))\nfib_daily_long_nonbay &lt;- fib_daily_long |&gt; \n    filter(Station %in% fib_daily_nonbay$Station)\n\n\n\n\nCode\nggplot(fib_daily_long, aes(x = total, y = val)) +\n    geom_point(aes(col = time_period),\n               alpha = 0.4) +\n    facet_wrap(~BAY_SEG) +\n    scale_x_log10() +\n    scale_y_log10() +\n    scale_color_okabeito() +\n    labs(title = \"All stations\",\n         subtitle = \"note log-log scale\",\n         x = \"Precip (inches)\",\n         y = \"Enterococcus\",\n         col = \"time period of precip total\")\n\n\n\n\n\n\n\nCode\nggplot(fib_daily_long, aes(x = total, y = val)) +\n    geom_point(aes(col = BAY_SEG),\n               alpha = 0.4) +\n    facet_wrap(~time_period) +\n    scale_x_log10() +\n    scale_y_log10() +\n    scale_color_okabeito() +\n    labs(title = \"All stations\",\n         subtitle = \"note log-log scale\",\n         x = \"Precip (inches)\",\n         y = \"Enterococcus\",\n         col = \"Bay Segment\")\n\n\n\n\n\n\n\nCode\nggplot(fib_daily_long_nonbay, aes(x = total, y = val)) +\n    geom_point(aes(col = time_period),\n               alpha = 0.4) +\n    facet_wrap(~BAY_SEG) +\n    scale_x_log10() +\n    scale_y_log10() +\n    scale_color_okabeito() +\n    labs(title = \"Non-bay stations\",\n         subtitle = \"note log-log scale\",\n         x = \"Precip (inches)\",\n         y = \"Enterococcus\",\n         col = \"time period of precip total\")\n\n\n\n\n\n\n\nCode\nggplot(fib_daily_long_nonbay, aes(x = total, y = val)) +\n    geom_point(aes(col = BAY_SEG),\n               alpha = 0.4) +\n    facet_wrap(~time_period) +\n    scale_x_log10() +\n    scale_y_log10() +\n    scale_color_okabeito() +\n    labs(title = \"Non-bay stations\",\n         subtitle = \"note log-log scale\",\n         x = \"Precip (inches)\",\n         y = \"Enterococcus\",\n         col = \"Bay Segment\")\n\n\n\n\n\n\n3.9.1 Calculate correlations\nSpearman correlations\n\n3.9.1.1 All stations, all bay segments combined\n\n\nCode\nall_stns &lt;- fib_daily_prcp |&gt; \n    st_drop_geometry() |&gt; \n    select(val, inches:daily_7d) |&gt; \n    set_names(c(\"Entero\", \"sample_day_precip\",\n                \"sample_and_24hrs\",\n                \"sample_and_48hrs\",\n                \"previous_week\"))\n\n\n\n\nCode\ncorr_all &lt;- cor(all_stns,\n    use = \"pairwise.complete.obs\",\n    method = \"spearman\")\n\nknitr::kable(corr_all,\n             caption = \"Spearman correlation coefficients\",\n             digits = 3)\n\n\n\nSpearman correlation coefficients\n\n\n\n\n\n\n\n\n\n\n\nEntero\nsample_day_precip\nsample_and_24hrs\nsample_and_48hrs\nprevious_week\n\n\n\n\nEntero\n1.000\n0.096\n0.140\n0.136\n0.125\n\n\nsample_day_precip\n0.096\n1.000\n0.859\n0.734\n0.527\n\n\nsample_and_24hrs\n0.140\n0.859\n1.000\n0.883\n0.634\n\n\nsample_and_48hrs\n0.136\n0.734\n0.883\n1.000\n0.735\n\n\nprevious_week\n0.125\n0.527\n0.634\n0.735\n1.000\n\n\n\n\n\nCode\nknitr::kable(cor.mtest(corr_all)$p,\n             caption = \"p-values of Spearman correlations\",\n             digits = 3)\n\n\n\np-values of Spearman correlations\n\n\n\n\n\n\n\n\n\n\n\nEntero\nsample_day_precip\nsample_and_24hrs\nsample_and_48hrs\nprevious_week\n\n\n\n\nEntero\n0.000\n0.050\n0.029\n0.022\n0.084\n\n\nsample_day_precip\n0.050\n0.000\n0.017\n0.091\n0.436\n\n\nsample_and_24hrs\n0.029\n0.017\n0.000\n0.017\n0.284\n\n\nsample_and_48hrs\n0.022\n0.091\n0.017\n0.000\n0.132\n\n\nprevious_week\n0.084\n0.436\n0.284\n0.132\n0.000\n\n\n\n\n\n\n\n3.9.1.2 Non-bay stations, all bay segments combined\n\n\nCode\nnonbay_stns &lt;- fib_daily_nonbay |&gt; \n    st_drop_geometry() |&gt; \n    select(val, inches:daily_7d) |&gt; \n    set_names(c(\"Entero\", \"sample_day_precip\",\n                \"sample_and_24hrs\",\n                \"sample_and_48hrs\",\n                \"previous_week\"))\n\n\n\n\nCode\ncorr_all &lt;- cor(nonbay_stns,\n    use = \"pairwise.complete.obs\",\n    method = \"spearman\")\n\nknitr::kable(corr_all,\n             caption = \"Spearman correlation coefficients\",\n             digits = 3)\n\n\n\nSpearman correlation coefficients\n\n\n\n\n\n\n\n\n\n\n\nEntero\nsample_day_precip\nsample_and_24hrs\nsample_and_48hrs\nprevious_week\n\n\n\n\nEntero\n1.000\n0.113\n0.184\n0.201\n0.212\n\n\nsample_day_precip\n0.113\n1.000\n0.829\n0.726\n0.517\n\n\nsample_and_24hrs\n0.184\n0.829\n1.000\n0.911\n0.650\n\n\nsample_and_48hrs\n0.201\n0.726\n0.911\n1.000\n0.753\n\n\nprevious_week\n0.212\n0.517\n0.650\n0.753\n1.000\n\n\n\n\n\nCode\nknitr::kable(cor.mtest(corr_all)$p,\n             caption = \"p-values of Spearman correlations\",\n             digits = 3)\n\n\n\np-values of Spearman correlations\n\n\n\n\n\n\n\n\n\n\n\nEntero\nsample_day_precip\nsample_and_24hrs\nsample_and_48hrs\nprevious_week\n\n\n\n\nEntero\n0.000\n0.036\n0.028\n0.033\n0.156\n\n\nsample_day_precip\n0.036\n0.000\n0.035\n0.117\n0.537\n\n\nsample_and_24hrs\n0.028\n0.035\n0.000\n0.012\n0.316\n\n\nsample_and_48hrs\n0.033\n0.117\n0.012\n0.000\n0.155\n\n\nprevious_week\n0.156\n0.537\n0.316\n0.155\n0.000\n\n\n\n\n\n\n\n3.9.1.3 Non-bay stations, by bay segment\n\n\nCode\noptions(scipen = 999)\n\nmy_cor &lt;- function(df, x){\n    cor(df[[\"val\"]], df[[x]],\n        method = \"spearman\",\n        use = \"pairwise.complete.obs\")\n}\n\nmy_cor.p &lt;- function(df, x){\n    cor.test(df[[\"val\"]], df[[x]],\n        method = \"spearman\",\n        use = \"pairwise.complete.obs\")$p.value\n}\n\n\n\n\nCode\nnonbay_stns2 &lt;- fib_daily_nonbay |&gt; \n    st_drop_geometry() |&gt; \n    filter(BAY_SEG != \"Manatee River\") |&gt; # no values, messing things up\n    select(BAY_SEG, val, inches:daily_7d) |&gt; \n    summarize(.by = BAY_SEG,\n              cor.sampleday = my_cor(.data, \"inches\"),  # this could all be more elegant\n              pval.sampleday = my_cor.p(.data, \"inches\"),\n              cor.24hrs = my_cor(.data, \"daily_24hrs\"),\n              pval.24hrs = my_cor.p(.data, \"daily_24hrs\"),\n              cor.48hrs = my_cor(.data, \"daily_48hrs\"),\n              pval.48hrs = my_cor.p(.data, \"daily_48hrs\"),\n              cor.7d = my_cor(.data, \"daily_7d\"),\n              pval.7d = my_cor.p(.data, \"daily_7d\"))\n\nknitr::kable(nonbay_stns2,\n             caption = \"Spearman Correlations and p-values for Entero~rainfall by bay segment\",\n             digits = 3)    \n\n\n\nSpearman Correlations and p-values for Entero~rainfall by bay segment\n\n\n\n\n\n\n\n\n\n\n\n\n\nBAY_SEG\ncor.sampleday\npval.sampleday\ncor.24hrs\npval.24hrs\ncor.48hrs\npval.48hrs\ncor.7d\npval.7d\n\n\n\n\nBoca Ciega Bay\n0.224\n0.006\n0.417\n0.000\n0.473\n0.000\n0.356\n0.000\n\n\nHillsborough Bay\n0.165\n0.000\n0.199\n0.000\n0.228\n0.000\n0.265\n0.000\n\n\nLower Tampa Bay\n0.102\n0.113\n0.097\n0.131\n0.103\n0.108\n0.094\n0.142\n\n\nMiddle Tampa Bay\n0.083\n0.118\n0.179\n0.001\n0.177\n0.001\n0.140\n0.008\n\n\nOld Tampa Bay\n0.059\n0.370\n0.130\n0.049\n0.088\n0.185\n0.068\n0.301"
  },
  {
    "objectID": "FIBs_and_hydrology.html#wet-vs.-dry-season",
    "href": "FIBs_and_hydrology.html#wet-vs.-dry-season",
    "title": "3  Fecal Indicator Bacteria (FIBs) and Hydrology",
    "section": "3.10 Wet vs. Dry Season",
    "text": "3.10 Wet vs. Dry Season\nWet season is June-Sept. Dry is the rest.\n\n\nCode\nfib_daily_long_nonbay |&gt; \n    filter(time_period == \"sample + 2 days\") |&gt; \nggplot(aes(x = total, y = val, shape = Season)) +\n    geom_point(aes(col = Season),\n               alpha = 0.5,\n               size = 2) +\n    facet_wrap(~BAY_SEG) +\n    scale_x_log10(breaks = c(0.001, 0.01, 0.1, 1),\n                  labels = c(\"0.001\", \"0.01\", \"0.1\", \"1\")) +\n    scale_y_log10() +\n    scale_color_muted() +\n    labs(title = \"Non-bay stations, previous 48 hrs\",\n         subtitle = \"note log-log scale\",\n         x = \"Precip (inches)\",\n         y = \"Enterococcus\") +\n    theme(axis.text.x = element_text(angle = 40, \n                                     hjust = 1,\n                                     vjust = 1))\n\n\n\n\n\nCode\nfib_daily_long_nonbay |&gt; \n    filter(time_period == \"sample + 2 days\") |&gt; \nggplot(aes(x = total, y = val, shape = Season)) +\n    geom_point(aes(col = Season),\n               alpha = 0.5,\n               size = 2) +\n    facet_wrap(~BAY_SEG) +\n    scale_y_log10() +\n    scale_color_muted() +\n    labs(title = \"Non-bay stations, previous 48 hrs\",\n         subtitle = \"note log10 y-axis; x-axis unscaled\",\n         x = \"Precip (inches)\",\n         y = \"Enterococcus\") \n\n\n\n\n\n\n\nCode\nnonbay_stns3 &lt;- fib_daily_nonbay |&gt; \n    st_drop_geometry() |&gt; \n    filter(BAY_SEG != \"Manatee River\") |&gt; # no values, messign things up\n    select(BAY_SEG, Season, val, inches:daily_7d) |&gt; \n    summarize(.by = c(BAY_SEG, Season),\n              cor.sampleday = my_cor(.data, \"inches\"),  # this could all be more elegant\n              pval.sampleday = my_cor.p(.data, \"inches\"),\n              cor.24hrs = my_cor(.data, \"daily_24hrs\"),\n              pval.24hrs = my_cor.p(.data, \"daily_24hrs\"),\n              cor.48hrs = my_cor(.data, \"daily_48hrs\"),\n              pval.48hrs = my_cor.p(.data, \"daily_48hrs\"),\n              cor.7d = my_cor(.data, \"daily_7d\"),\n              pval.7d = my_cor.p(.data, \"daily_7d\"))\n\nknitr::kable(nonbay_stns3,\n             caption = \"Spearman Correlations and p-values for Entero~rainfall by bay segment\",\n             digits = 3)    \n\n\n\nSpearman Correlations and p-values for Entero~rainfall by bay segment\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nBAY_SEG\nSeason\ncor.sampleday\npval.sampleday\ncor.24hrs\npval.24hrs\ncor.48hrs\npval.48hrs\ncor.7d\npval.7d\n\n\n\n\nBoca Ciega Bay\nDry\n-0.023\n0.834\n0.237\n0.029\n0.343\n0.001\n0.405\n0.000\n\n\nBoca Ciega Bay\nWet\n0.336\n0.007\n0.495\n0.000\n0.475\n0.000\n0.107\n0.403\n\n\nHillsborough Bay\nWet\n0.042\n0.545\n0.099\n0.153\n0.078\n0.263\n0.096\n0.166\n\n\nHillsborough Bay\nDry\n0.106\n0.039\n0.124\n0.016\n0.171\n0.001\n0.206\n0.000\n\n\nLower Tampa Bay\nDry\n0.027\n0.745\n0.017\n0.839\n0.007\n0.936\n-0.025\n0.766\n\n\nLower Tampa Bay\nWet\n0.156\n0.130\n0.169\n0.099\n0.228\n0.026\n0.262\n0.010\n\n\nMiddle Tampa Bay\nDry\n-0.028\n0.675\n0.155\n0.019\n0.171\n0.010\n0.146\n0.027\n\n\nMiddle Tampa Bay\nWet\n0.128\n0.156\n0.199\n0.026\n0.173\n0.054\n0.089\n0.321\n\n\nOld Tampa Bay\nDry\n0.039\n0.642\n0.141\n0.091\n0.136\n0.103\n0.097\n0.247\n\n\nOld Tampa Bay\nWet\n0.036\n0.742\n0.012\n0.915\n-0.085\n0.434\n-0.056\n0.611"
  },
  {
    "objectID": "FIBs_and_hydrology.html#ecdfs",
    "href": "FIBs_and_hydrology.html#ecdfs",
    "title": "3  Fecal Indicator Bacteria (FIBs) and Hydrology",
    "section": "3.11 ECDFs",
    "text": "3.11 ECDFs\nEmpirical cumulative distribution functions\n\n3.11.1 Freshwater\nDifferences due to precipitation may show up better in freshwater than estuarine waters; I’ll explore that a little bit here just to see what it looks like.\n\n\nCode\nfib_fresh &lt;- fib_dat |&gt; \n    filter(class == \"Fresh\",\n           var == \"ecocci\") |&gt; \n    mutate(Season = case_when(mo %in% c(6:9) ~ \"Wet\",\n                              .default = \"Dry\"))\n\nfib_fresh_baysegs &lt;- fib_fresh |&gt; \n    st_as_sf(coords = c(\"Longitude\", \"Latitude\"),\n             crs = \"WGS84\",\n             remove = FALSE) |&gt;    # WGS84 is default for handheld GPS units\n    st_transform(crs = st_crs(swfwmdpixels)) |&gt; \n    st_intersection(bay_segs) |&gt; \n    mutate(bay_segment = case_match(BAY_SEG,\n                                    \"Boca Ciega Bay\" ~ \"Remainder Lower Tampa Bay\",\n                                    \"Manatee River\" ~ \"Remainder Lower Tampa Bay\",\n                                    .default = BAY_SEG))\n\nfib_fresh_hydro &lt;- left_join(fib_fresh_baysegs, combnd,\n                       by = c(\"yr\" = \"year\",\n                              \"mo\" = \"month\",\n                              \"bay_segment\"))\n\n\n\n\nCode\nggplot(fib_fresh_hydro, aes(x = val, col = Season)) +\n    geom_density() +\n    scale_x_log10() +\n    facet_wrap(~BAY_SEG, scales = \"free_y\") +\n    labs(title = \"Distribution of Enterococcus concentrations at Freshwater stations\",\n         subtitle = \"note log10 x-axis\",\n         x = \"Enterococcus count\",\n         y = \"Density\")\n\n\n\n\n\n\n\nCode\nggplot(fib_fresh_hydro, aes(x = val, col = Season)) +\n    stat_ecdf() +\n    scale_x_log10() +\n    facet_wrap(~BAY_SEG) +\n    labs(title = \"ECDF for freshwater Enterococcus samples by season and bay segment\",\n         subtitle = \"note log10 x-axis\",\n         x = \"Enterococcus value\",\n         y = \"cumulative proportion\")\n\n\n\n\n\n\n\nCode\nggplot(fib_fresh_hydro, aes(x = val, col = Season, group = mo)) +\n    stat_ecdf() +\n    scale_x_log10() +\n    # facet_wrap(~mo) +\n    labs(title = \"ECDF for freshwater Enterococcus samples by month\",\n         subtitle = \"note log10 x-axis\",\n         x = \"Enterococcus value\",\n         y = \"cumulative proportion\")\n\n\n\n\n\n\n\n3.11.2 Estuarine\n\n\nCode\nfib_nonbay &lt;- fib_nonbay |&gt; \n    mutate(Season = case_when(mo %in% c(6:9) ~ \"Wet\",\n                              .default = \"Dry\"))\n\n\n\n\nCode\nggplot(fib_nonbay, aes(x = val, col = Season)) +\n    stat_ecdf() +\n    scale_x_log10() +\n    labs(title = \"ECDF for estuarine Enterococcus samples by season across all bay segments\",\n         subtitle = \"note log10 x-axis\",\n         x = \"Enterococcus value\",\n         y = \"cumulative proportion\")\n\n\n\n\n\n\n\nCode\nggplot(fib_nonbay, aes(x = val, col = Season)) +\n    stat_ecdf() +\n    scale_x_log10() +\n    facet_wrap(~BAY_SEG) +\n    labs(title = \"ECDF for estuarine Enterococcus samples by season and bay segment\",\n         subtitle = \"note log10 x-axis\",\n         x = \"Enterococcus value\",\n         y = \"cumulative proportion\")\n\n\n\n\n\n\n\nCode\nggplot(fib_nonbay, aes(x = val, col = Season, group = mo)) +\n    stat_ecdf() +\n    scale_x_log10() +\n    # facet_wrap(~mo) +\n    labs(title = \"ECDF for estuarine Enterococcus samples by month\",\n         subtitle = \"note log10 x-axis\",\n         x = \"Enterococcus value\",\n         y = \"cumulative proportion\")\n\n\n\n\n\n\n\nCode\nggplot(fib_nonbay, aes(x = val, col = Season, group = mo)) +\n    stat_ecdf() +\n    scale_x_log10() +\n    facet_wrap(~BAY_SEG) +\n    labs(title = \"ECDF for estuarine Enterococcus samples by month and bay segment\",\n         subtitle = \"note log10 x-axis\",\n         x = \"Enterococcus value\",\n         y = \"cumulative proportion\")\n\n\n\n\n\nNot as clear separation in estuarine samples as in freshwater samples, but when all lumped together, there is still some. Generally the Enterococcus levels are lower in dry than in wet seasons."
  },
  {
    "objectID": "takeaways.html",
    "href": "takeaways.html",
    "title": "Takeaways",
    "section": "",
    "text": "General takeaways from all that exploration will go here."
  }
]